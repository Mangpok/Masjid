<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projek Nasikabu - Mengumpul Dana Masjid Al-Hilaliyah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans Thai', sans-serif;
            background: linear-gradient(to bottom right, #f5f5f4, #d6d3d1);
        }
        .chart-container {
            position: relative;
            margin: auto;
            height: 300px;
            width: 300px;
        }
        .chart-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        .button-hover-effect {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .button-hover-effect:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">

        <!-- Language Switcher -->
        <div class="flex justify-end mt-8 mb-4">
            <button onclick="setLanguage('th')" class="bg-emerald-800 text-white font-bold py-1 px-3 rounded-l-full hover:bg-emerald-700 transition-colors">TH</button>
            <button onclick="setLanguage('ms')" class="bg-emerald-600 text-white font-bold py-1 px-3 rounded-r-full hover:bg-emerald-500 transition-colors">MY</button>
        </div>

        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-emerald-800 drop-shadow-md" data-i18n="project_title">โครงการนาซิกาบู</h1>
            <p class="text-xl md:text-2xl mt-2 text-stone-600" data-i18n="project_subtitle">รวมพลังศรัทธา สร้างมัสยิดอัลฮีลาลียะห์</p>
        </header>

        <main>
            <section id="progress" class="bg-white rounded-2xl shadow-xl p-6 md:p-8 mb-8 md:mb-12">
                <h2 class="text-2xl md:text-3xl font-bold text-emerald-800 mb-4 text-center" data-i18n="progress_heading">ความคืบหน้ายอดบริจาค</h2>
                <div class="grid md:grid-cols-2 gap-8 items-start">
                    <div class="flex flex-col items-center text-center">
                        <p class="text-stone-600 mb-6" data-i18n="progress_description">ร่วมเป็นส่วนหนึ่งในการเติมเต็มเป้าหมาย 3,000,000 บาท เพื่อสร้างบ้านของอัลลอฮฺให้สำเร็จ</p>
                        
                        <div class="chart-container">
                            <canvas id="donationChart"></canvas>
                            <div id="chartText" class="chart-text">
                                <span id="percentageText" class="text-4xl font-bold text-emerald-800">0%</span>
                                <span class="block text-stone-500" data-i18n="donation_label">ยอดบริจาค</span>
                                <span id="currentTimeText" class="block text-sm text-stone-400 mt-1"></span>
                            </div>
                        </div>
                        <div class="mt-6">
                            <p class="font-bold text-lg"><span data-i18n="current_amount_label">ยอดบริจาคปัจจุบัน:</span> <span id="currentAmountText" class="text-amber-600">0</span> บาท</p>
                            <p class="text-stone-500"><span data-i18n="goal_from">จากเป้าหมาย</span> 3,000,000 บาท</p>
                        </div>
                        <!-- <div class="mt-6 p-4 bg-stone-100 rounded-lg">
                            <label for="donationInput" class="block text-sm font-medium text-stone-700 mb-2" data-i18n="input_label">ป้อนยอดเงินบริจาค (บาท)</label>
                            <input id="donationInput" type="number" min="0" max="3000000" placeholder="เช่น 100" class="w-full p-2 rounded-lg border-2 border-stone-300 focus:outline-none focus:border-emerald-500 text-center">
                        </div> -->
                    </div>
                    
                    <div class="flex flex-col items-center">
                        <img src="https://img5.pic.in.th/file/secure-sv1/Yellow-White-Modern-Ramadan-Iftar-Party-Promotion-Poster-2.png" alt="โปสเตอร์งานนาซิกาบู" class="w-full h-auto rounded-xl shadow-md max-w-sm">
                    </div>
                </div>
            </section>
            
            <section id="donate" class="bg-emerald-800 text-white rounded-2xl shadow-xl p-6 md:p-8 mb-8 md:mb-12">
                <h2 class="text-3xl font-bold text-center mb-6" data-i18n="donation_channels">ช่องทางการบริจาค</h2>
                <div class="grid md:grid-cols-2 gap-6 text-center">
                    <div class="bg-emerald-700 p-6 rounded-xl button-hover-effect">
                        <h4 class="text-xl font-bold mb-2" data-i18n="islamic_bank_title">ธนาคารอิสลามแห่งประเทศไทย</h4>
                        <p id="islamicBankAcc" class="text-2xl font-mono tracking-wider mb-3">0901066346</p>
                        <p class="mb-4" data-i18n="account_name_prefix">ชื่อบัญชี: มัสยิดอัลฮีลาลียะห์</p>
                        <button onclick="copyToClipboard('islamicBankAcc')" class="bg-white text-emerald-800 font-bold py-2 px-4 rounded-lg hover:bg-stone-200 transition-colors" data-i18n="copy_button">คัดลอกเลขบัญชี</button>
                    </div>
                    <div class="bg-emerald-700 p-6 rounded-xl button-hover-effect">
                        <h4 class="text-xl font-bold mb-2" data-i18n="maybank_title">Maybank</h4>
                        <p id="maybankAcc" class="text-2xl font-mono tracking-wider mb-3">557139279538</p>
                        <p class="mb-4" data-i18n="account_name_prefix">ชื่อบัญชี: Usman Sulung</p>
                        <button onclick="copyToClipboard('maybankAcc')" class="bg-white text-emerald-800 font-bold py-2 px-4 rounded-lg hover:bg-stone-200 transition-colors" data-i18n="copy_button">คัดลอกเลขบัญชี</button>
                    </div>
                    <!-- QR Code donation option without title -->
                    <div class="bg-emerald-700 p-6 rounded-xl button-hover-effect md:col-span-2">
                        <div class="flex justify-center">
                            <img src="https://img2.pic.in.th/pic/qrpay.jpg" alt="QR Code for donation" class="w-48 h-auto rounded-lg shadow-md">
                        </div>
                    </div>
                </div>
                <div id="copy-feedback" class="text-center mt-4 h-6 text-amber-300 font-bold transition-opacity duration-300 opacity-0"></div>
            </section>
        </main>

        <footer class="text-center mt-8 md:mt-12 text-stone-500">
            <p data-i18n="footer_message">"ผลบุญที่ท่านสร้างวันนี้ คือบ้านของท่านในอาคิเราะห์"</p>
            <p class="mt-2 text-sm">&copy; 2568 <span data-i18n="footer_project_name">โครงการมัสยิดอัลฮีลาลียะห์</span></p>
        </footer>
    </div>

    <script>
        // โค้ดทั้งหมดอยู่ในฟังก์ชันเดียวเพื่อจัดการการทำงาน
        (async function() {
            const donationGoal = 3000000;
            const currentTimeText = document.getElementById('currentTimeText');
            const copyFeedbackEl = document.getElementById('copy-feedback');
            const percentageText = document.getElementById('percentageText');
            const currentAmountText = document.getElementById('currentAmountText');
            let currentLang = 'th';
            
            // ข้อมูลสำหรับแปลภาษา
            const translations = {
                th: {
                    project_title: 'โครงการนาซิกาบู',
                    project_subtitle: 'รวมพลังศรัทธา สร้างมัสยิดอัลฮีลาลียะห์',
                    progress_heading: 'ความคืบหน้ายอดบริจาค',
                    progress_description: 'ร่วมเป็นส่วนหนึ่งในการเติมเต็มเป้าหมาย 3,000,000 บาท เพื่อสร้างบ้านของอัลลอฮฺให้สำเร็จ',
                    donation_label: 'ยอดบริจาค',
                    current_amount_label: 'ยอดบริจาคปัจจุบัน:',
                    goal_from: 'จากเป้าหมาย',
                    input_label: 'ป้อนยอดเงินบริจาค (บาท)',
                    donation_channels: 'ช่องทางการบริจาค',
                    islamic_bank_title: 'ธนาคารอิสลามแห่งประเทศไทย',
                    maybank_title: 'Maybank',
                    qr_title: 'ชำระเงินด้วย QR Code',
                    qr_description: 'สแกนเพื่อบริจาคทันที',
                    account_name_prefix: 'ชื่อบัญชี:',
                    copy_button: 'คัดลอกเลขบัญชี',
                    copy_success: 'คัดลอกเลขบัญชีเรียบร้อยแล้ว!',
                    footer_message: 'ผลบุญที่ท่านสร้างวันนี้ คือบ้านของท่านในอาคิเราะห์',
                    footer_project_name: 'โครงการมัสยิดอัลฮีลาลียะห์',
                },
                ms: {
                    project_title: 'Projek Nasikabu',
                    project_subtitle: 'Bersatu Hati Membina Masjid Al-Hilaliyah',
                    progress_heading: 'Kemajuan Dana Sumbangan',
                    progress_description: 'Sertai kami dalam mencapai sasaran 3,000,000 Baht untuk menyelesaikan Rumah Allah.',
                    donation_label: 'Sumbangan',
                    current_amount_label: 'Jumlah Sumbangan Semasa:',
                    goal_from: 'Dari sasaran',
                    input_label: 'Masukkan jumlah sumbangan (Baht)',
                    donation_channels: 'Saluran Sumbangan',
                    islamic_bank_title: 'Bank Islam Thailand',
                    maybank_title: 'Maybank',
                    qr_title: 'Bayar dengan Kod QR',
                    qr_description: 'Imbas untuk menyumbang sekarang',
                    account_name_prefix: 'Nama Akaun:',
                    copy_button: 'Salin Nombor Akaun',
                    copy_success: 'Nombor akaun berjaya disalin!',
                    footer_message: 'Pahala yang anda bina hari ini, adalah rumah anda di Akhirat.',
                    footer_project_name: 'Projek Masjid Al-Hilaliyah',
                }
            };
            
            // สร้าง Doughnut Chart
            const ctx = document.getElementById('donationChart').getContext('2d');
            const donationChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [0, donationGoal],
                        backgroundColor: ['#f59e0b', '#e5e7eb'],
                        borderWidth: 0,
                        borderRadius: 10,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '75%',
                    plugins: {
                        tooltip: { enabled: false }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true
                    }
                }
            });

            // ฟังก์ชันสำหรับอัปเดตข้อมูลบนหน้าเว็บ
            function updateChart(amount) {
                const percentage = Math.min(100, (amount / donationGoal) * 100);
                
                // อัปเดตกราฟ
                donationChart.data.datasets[0].data[0] = amount;
                donationChart.data.datasets[0].data[1] = Math.max(0, donationGoal - amount);
                donationChart.update();
                
                // อัปเดตข้อความยอดบริจาค
                percentageText.textContent = `${percentage.toFixed(1)}%`;
                currentAmountText.textContent = amount.toLocaleString('th-TH');
            }

            // ฟังก์ชันสำหรับเปลี่ยนภาษา
            window.setLanguage = function(lang) {
                currentLang = lang;
                const elements = document.querySelectorAll('[data-i18n]');
                elements.forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (translations[lang][key]) {
                        el.textContent = translations[lang][key];
                    }
                });
                updateClock(); // อัปเดตเวลาตามภาษาใหม่
            };

            // ฟังก์ชันสำหรับอัปเดตเวลาปัจจุบัน
            function updateClock() {
                const now = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };
                let locale = (currentLang === 'ms') ? 'ms-MY' : 'th-TH';
                const formattedTime = now.toLocaleDateString(locale, options);
                currentTimeText.textContent = `${formattedTime}`;
            }

            // ฟังก์ชันสำหรับคัดลอกเลขบัญชี
            window.copyToClipboard = function(elementId) {
                const textToCopy = document.getElementById(elementId).innerText;
                const tempInput = document.createElement('input');
                tempInput.value = textToCopy;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);

                copyFeedbackEl.textContent = translations[currentLang].copy_success;
                copyFeedbackEl.classList.remove('opacity-0');
                setTimeout(() => {
                    copyFeedbackEl.classList.add('opacity-0');
                }, 2000);
            };

            // ฟังก์ชันหลักสำหรับดึงข้อมูลจาก Google Sheet
            async function fetchSheet() {
                console.log('กำลังดึงข้อมูลจาก Google Sheet...');
                const url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSdxUvZTFoCoJODdiGXDsofsY8Dfl27i59rtjyKhFeLw4U3viAqbWrVGvgn9HHu6dpT3ngUAzooaRnv/pub?gid=0&single=true&output=csv';
                
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const csvText = await response.text();
                    
                    // แยกบรรทัดและคอลัมน์เพื่อหาผลรวม
                    const rows = csvText.split('\n').filter(row => row.trim());
                    let totalAmount = 0;
                    
                    rows.forEach(row => {
                        const value = parseFloat(row.split(',')[0]);
                        if (!isNaN(value)) {
                            totalAmount += value;
                        }
                    });
                    
                    // อัปเดตยอดบริจาคด้วยผลรวมที่ได้
                    updateChart(totalAmount);
                    console.log(`ดึงข้อมูลสำเร็จ! ยอดรวม: ${totalAmount.toLocaleString('th-TH')} บาท`);

                } catch (error) {
                    console.error('เกิดข้อผิดพลาดในการดึงข้อมูล:', error);
                    // หากเกิดข้อผิดพลาดในการดึงข้อมูล จะใช้ค่าเริ่มต้น 0
                    updateChart(0);
                }
            }

            // เริ่มการทำงานเมื่อหน้าเว็บโหลดเสร็จ
            window.onload = function() {
                // กำหนดภาษาเริ่มต้นเป็นภาษาไทย
                setLanguage('th');
                // อัปเดตยอดบริจาคเริ่มต้น (สามารถใช้ค่า 0 หรือค่าที่ต้องการ)
                updateChart(0);
                // เริ่มอัปเดตเวลาปัจจุบัน
                setInterval(updateClock, 1000);
                // ดึงข้อมูลครั้งแรก
                fetchSheet();
                // ตั้งค่าให้อัปเดตข้อมูลทุกๆ 10 นาที
                setInterval(fetchSheet, 1000 * 60 * 10);
            }
        })();
    </script>
</body>
</html>
